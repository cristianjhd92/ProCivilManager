# File: BackEnd/.env.example
# Descripción: Variables de entorno para el servidor Node/Express + MongoDB + JWT + CORS
# NOTA: No comprometas este archivo con secretos reales. Copia como ".env" y completa allí.

# =========================
# App / Servidor HTTP
# =========================
PORT=5000                                   # Puerto donde corre Express (dev: 5000)
NODE_ENV=development                        # (development|production|test)
CORS_ORIGIN=http://localhost:3000           # Origen permitido para CORS/Socket.io (una sola URL)

# =========================
# Base de datos (MongoDB)
# =========================
# Reemplaza <USER>, <PASSWORD>, <CLUSTER>, <DB_NAME>, <APP_NAME>
MONGO_URI=mongodb+srv://<USER>:<PASSWORD>@<CLUSTER>/<DB_NAME>?retryWrites=true&w=majority&appName=<APP_NAME>
MONGOOSE_DEBUG=true                         # true en desarrollo para ver queries

# =========================
# Autenticación (JWT de acceso)
# =========================
JWT_SECRET=<CAMBIA_ESTA_CLAVE_LARGA_Y_UNICA> # Clave para firmar access tokens
JWT_ACCESS_EXPIRES=15m                      # Duración del access token (ej: 15m, 1h)
JWT_ISSUER=procivil-manager                 # Claim "iss" (opcional)
JWT_AUDIENCE=procivil-manager-frontend      # Claim "aud" (opcional)

# =========================
# Refresh Tokens (Cookie HttpOnly)
# =========================
# Los refresh tokens NO son JWT; se guardan hasheados en BD.
REFRESH_TOKEN_TTL_DAYS=30                   # Vida del refresh token (días)
REFRESH_TOKEN_COOKIE=pm_rt                  # Nombre de la cookie del refresh
REFRESH_COOKIE_DOMAIN=localhost             # En prod: tu dominio (p.ej. api.tu-dominio.com)
REFRESH_COOKIE_PATH=/                       # Path de la cookie
REFRESH_COOKIE_HTTPONLY=true                # Debe ser true
REFRESH_COOKIE_SECURE=false                 # En prod con HTTPS: true
REFRESH_COOKIE_SAMESITE=Lax                 # En cross-site real: "None" (requiere Secure=true)

# =========================
# Correo saliente (SMTP)
# =========================
SMTP_HOST=smtp.gmail.com                    # Ejemplo: Gmail
SMTP_PORT=465                               # 465=SSL; 587=STARTTLS
SMTP_SECURE=true                            # true para 465; false para 587
SMTP_USER=<SMTP_USER_EMAIL>                 # Ej: no-reply@tu-dominio.com
SMTP_PASS=<SMTP_APP_PASSWORD>               # App Password (no el login normal)
MAIL_FROM="Procivil Manager" <no-reply@tu-dominio.com>   # Remitente por defecto
SUPPORT_EMAIL=soporte@tu-dominio.com        # Correo de soporte (reply-to / plantillas)

# =========================
# Frontend / URLs
# =========================
FRONTEND_URL=http://localhost:3000          # URL del frontend (links en correos, etc.)

# =========================
# Notificaciones internas
# =========================
CONTACT_NOTIFICATIONS_TO=soporte@tu-dominio.com   # Destinatarios (CSV)
PROJECT_NOTIFICATIONS_TO=soporte@tu-dominio.com   # Destinatarios (CSV)

# =========================
# Rate limiting
# =========================
# Modo "legado" (controla ambos limiters de /login con una sola ventana y máximo)
RATE_LIMIT_LOGIN_WINDOW_MIN=5               # Ventana de rate limit (minutos)
RATE_LIMIT_LOGIN_MAX=3                      # Intentos permitidos por IP/usuario en la ventana

# Modo granular (si se define, TIENE prioridad sobre el legado)
# Global (toda la API)
RATE_LIMIT_GLOBAL_WINDOW_MS=60000           # 60 s
RATE_LIMIT_GLOBAL_MAX=120                   # 120 req/ventana/IP

# Login por IP
RATE_LIMIT_LOGIN_IP_WINDOW_MS=300000        # 5 min (en ms)
RATE_LIMIT_LOGIN_IP_MAX=3                   # 3 intentos por IP/ventana

# Login por USUARIO
RATE_LIMIT_LOGIN_USER_WINDOW_MS=300000      # 5 min (en ms)
RATE_LIMIT_LOGIN_USER_MAX=3                 # 3 intentos por usuario/ventana

# =========================
# Bloqueo temporal por cuenta (lockout)
# =========================
LOCKOUT_MAX_ATTEMPTS=3                      # Bloquea al 3er intento fallido dentro de la ventana
LOCKOUT_WINDOW_MINUTES=3                    # Ventana de agregación de fallos (min)
LOCKOUT_DURATION_MINUTES=5                  # Bloqueo inicial (min)
LOCKOUT_BACKOFF_MULTIPLIER=2                # Cada nuevo bloqueo x2 (5,10,20,40,...)
LOCKOUT_MAX_DURATION_MINUTES=1440           # Tope de bloqueo (min) → 24h

# =========================
# Opcionales para pruebas CI/smoke (bypass de rate limit en dev/CI)
# =========================
SMOKE_BYPASS_RATE=0                         # 1 para habilitar bypass solo en CI/dev
RL_BYPASS_KEY=<OPCIONAL_SECRETO_COMPARTIDO> # Se envía como header x-smoke-bypass en scripts
